@page "/insights"
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@using Tempus.Core.Interfaces
@using Tempus.Core.Models
@using Tempus.Web.Components.Account
@attribute [Authorize]
@inject IAnalyticsService AnalyticsService
@inject IAnalyticsReportService ReportService
@inject ITrendForecastService TrendForecastService
@inject IBenchmarkService BenchmarkService
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject IJSRuntime JSRuntime
@inject ILogger<Insights> Logger

<PageTitle>Insights - Tempus</PageTitle>

<style>
    .benchmark-score-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .status-excellent {
        color: #4CAF50;
        background: rgba(76, 175, 80, 0.1);
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-weight: 600;
    }

    .status-at-standard {
        color: #2196F3;
        background: rgba(33, 150, 243, 0.1);
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-weight: 600;
    }

    .status-near-standard {
        color: #FF9800;
        background: rgba(255, 152, 0, 0.1);
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-weight: 600;
    }

    .status-below-standard {
        color: #F44336;
        background: rgba(244, 67, 54, 0.1);
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-weight: 600;
    }

    .recommendation-box {
        background: linear-gradient(135deg, #FFF9C4 0%, #FFEB3B 100%);
        border-left: 4px solid #FBC02D;
        padding: 1rem;
        border-radius: 8px;
    }
</style>

<div style="padding: 2rem;">
    <RadzenStack Gap="2rem">
        <!-- Header -->
        <RadzenCard Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 2rem; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
            <RadzenStack Gap="0.5rem">
                <RadzenText TextStyle="TextStyle.H3" Style="font-weight: 700; margin: 0;">ðŸ“Š Calendar Insights</RadzenText>
                <RadzenText TextStyle="TextStyle.Body1" Style="opacity: 0.9;">
                    Understand your time usage patterns and compare against industry standards
                </RadzenText>
            </RadzenStack>
        </RadzenCard>

        <!-- Tabs for different views -->
        <RadzenTabs RenderMode="TabRenderMode.Client" Change="@OnTabChange">
            <Tabs>
                <!-- Overview Tab -->
                <RadzenTabsItem Text="Overview" Icon="dashboard">
                    <RadzenStack Gap="1.5rem" Style="padding-top: 1.5rem;">
                        @if (_loadingOverview)
                        {
                            <RadzenCard Style="padding: 3rem; text-align: center;">
                                <RadzenStack Gap="1rem" AlignItems="AlignItems.Center">
                                    <RadzenProgressBarCircular ShowValue="false" Mode="ProgressBarMode.Indeterminate" Size="ProgressBarCircularSize.Large" />
                                    <RadzenText Style="opacity: 0.7;">Loading insights...</RadzenText>
                                </RadzenStack>
                            </RadzenCard>
                        }
                        else if (_analytics != null)
                        {
                            <!-- Quick Health Score -->
                            <RadzenCard>
                                <RadzenStack Gap="1rem">
                                    <RadzenText TextStyle="TextStyle.H5" Style="font-weight: 700;">Calendar Health Score</RadzenText>

                                    <RadzenRow>
                                        <RadzenColumn Size="12" SizeMD="4">
                                            <div style="text-align: center;">
                                                <RadzenArcGauge Style="width: 180px; height: 180px; margin: 0 auto;">
                                                    <RadzenArcGaugeScale Min="0" Max="100" Y="0.8">
                                                        <RadzenArcGaugeScaleValue Value="@_healthScore" Fill="@GetScoreColor(_healthScore)" />
                                                    </RadzenArcGaugeScale>
                                                </RadzenArcGauge>
                                                <RadzenText TextStyle="TextStyle.H4" Style="margin-top: 1rem;">@_healthScore.ToString("F0")/100</RadzenText>
                                                <RadzenText TextStyle="TextStyle.Body2" Style="color: #666;">@GetScoreLabel(_healthScore)</RadzenText>
                                            </div>
                                        </RadzenColumn>

                                        <RadzenColumn Size="12" SizeMD="8">
                                            <!-- Quick Stats Grid -->
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="6" SizeMD="6">
                                                    <RadzenCard Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem;">
                                                        <RadzenStack Gap="0.25rem">
                                                            <RadzenText TextStyle="TextStyle.DisplayH5" Style="font-weight: 800;">@_analytics.TotalEvents</RadzenText>
                                                            <RadzenText TextStyle="TextStyle.Body2">Total Events</RadzenText>
                                                        </RadzenStack>
                                                    </RadzenCard>
                                                </RadzenColumn>
                                                <RadzenColumn Size="6" SizeMD="6">
                                                    <RadzenCard Style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 1.5rem;">
                                                        <RadzenStack Gap="0.25rem">
                                                            <RadzenText TextStyle="TextStyle.DisplayH5" Style="font-weight: 800;">@_analytics.TotalHours</RadzenText>
                                                            <RadzenText TextStyle="TextStyle.Body2">Scheduled Hours</RadzenText>
                                                        </RadzenStack>
                                                    </RadzenCard>
                                                </RadzenColumn>
                                                <RadzenColumn Size="6" SizeMD="6">
                                                    <RadzenCard Style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 1.5rem;">
                                                        <RadzenStack Gap="0.25rem">
                                                            <RadzenText TextStyle="TextStyle.DisplayH5" Style="font-weight: 800;">@_analytics.MeetingCount</RadzenText>
                                                            <RadzenText TextStyle="TextStyle.Body2">Meetings</RadzenText>
                                                        </RadzenStack>
                                                    </RadzenCard>
                                                </RadzenColumn>
                                                <RadzenColumn Size="6" SizeMD="6">
                                                    <RadzenCard Style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 1.5rem;">
                                                        <RadzenStack Gap="0.25rem">
                                                            <RadzenText TextStyle="TextStyle.DisplayH5" Style="font-weight: 800;">$@_analytics.TotalMeetingCost.ToString("N0")</RadzenText>
                                                            <RadzenText TextStyle="TextStyle.Body2">Meeting Costs</RadzenText>
                                                        </RadzenStack>
                                                    </RadzenCard>
                                                </RadzenColumn>
                                            </RadzenRow>
                                        </RadzenColumn>
                                    </RadzenRow>
                                </RadzenStack>
                            </RadzenCard>

                            <!-- Top Recommendations -->
                            @if (_benchmarkReport != null && _benchmarkReport.TopRecommendations.Any())
                            {
                                <RadzenCard>
                                    <RadzenStack Gap="1rem">
                                        <RadzenText TextStyle="TextStyle.H6" Style="font-weight: 700;">ðŸ’¡ Top Recommendations</RadzenText>
                                        <RadzenStack Gap="0.5rem">
                                            @foreach (var recommendation in _benchmarkReport.TopRecommendations.Take(3))
                                            {
                                                <div class="recommendation-box">
                                                    <RadzenText TextStyle="TextStyle.Body2">@recommendation</RadzenText>
                                                </div>
                                            }
                                        </RadzenStack>
                                    </RadzenStack>
                                </RadzenCard>
                            }
                        }
                    </RadzenStack>
                </RadzenTabsItem>

                <!-- Time Analysis Tab -->
                <RadzenTabsItem Text="Time Analysis" Icon="schedule">
                    <RadzenStack Gap="1.5rem" Style="padding-top: 1.5rem;">
                        <!-- Controls -->
                        <RadzenCard>
                            <RadzenStack Orientation="Orientation.Horizontal" Gap="1.5rem" AlignItems="AlignItems.Center" Wrap="FlexWrap.Wrap" JustifyContent="JustifyContent.SpaceBetween">
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center">
                                    <RadzenText TextStyle="TextStyle.Subtitle1" Style="font-weight: 600;">Period:</RadzenText>
                                    <RadzenSplitButton Text="@GetPeriodText()"
                                                       Click="@(() => LoadAnalytics(_selectedDays))"
                                                       ButtonStyle="ButtonStyle.Primary"
                                                       Size="ButtonSize.Small"
                                                       Icon="calendar_today">
                                        <ChildContent>
                                            <RadzenSplitButtonItem Text="Last 7 Days" Value="7" Click="@(() => LoadAnalytics(7))" />
                                            <RadzenSplitButtonItem Text="Last 30 Days" Value="30" Click="@(() => LoadAnalytics(30))" />
                                            <RadzenSplitButtonItem Text="Last 90 Days" Value="90" Click="@(() => LoadAnalytics(90))" />
                                            <RadzenSplitButtonItem Text="Last Year" Value="365" Click="@(() => LoadAnalytics(365))" />
                                        </ChildContent>
                                    </RadzenSplitButton>
                                </RadzenStack>

                                @if (_analytics != null && !_loadingAnalytics)
                                {
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center">
                                        <RadzenText TextStyle="TextStyle.Subtitle1" Style="font-weight: 600;">Export:</RadzenText>
                                        <RadzenSplitButton Text="Download Report"
                                                           Click="@DownloadPdfReport"
                                                           ButtonStyle="ButtonStyle.Success"
                                                           Size="ButtonSize.Small"
                                                           Icon="download"
                                                           Disabled="@(_downloadingPdf || _downloadingCsv || _downloadingExcel)">
                                            <ChildContent>
                                                <RadzenSplitButtonItem Text="PDF Report" Icon="picture_as_pdf" Click="@(() => DownloadPdfReport())" Disabled="@_downloadingPdf" />
                                                <RadzenSplitButtonItem Text="CSV Data" Icon="table_view" Click="@(() => DownloadCsvReport())" Disabled="@_downloadingCsv" />
                                                <RadzenSplitButtonItem Text="Excel Report" Icon="description" Click="@(() => DownloadExcelReport())" Disabled="@_downloadingExcel" />
                                            </ChildContent>
                                        </RadzenSplitButton>
                                    </RadzenStack>
                                }
                            </RadzenStack>
                        </RadzenCard>

                        @if (_loadingAnalytics)
                        {
                            <RadzenCard Style="padding: 3rem; text-align: center;">
                                <RadzenStack Gap="1rem" AlignItems="AlignItems.Center">
                                    <RadzenProgressBarCircular ShowValue="false" Mode="ProgressBarMode.Indeterminate" Size="ProgressBarCircularSize.Large" />
                                    <RadzenText Style="opacity: 0.7;">Analyzing your calendar...</RadzenText>
                                </RadzenStack>
                            </RadzenCard>
                        }
                        else if (_analytics != null && _timeDistributionData.Any())
                        {
                            <!-- Time Distribution Chart -->
                            <RadzenCard>
                                <RadzenStack Gap="1rem">
                                    <RadzenText TextStyle="TextStyle.H6" Style="font-weight: 600;">Time Distribution by Event Type</RadzenText>
                                    <RadzenChart Style="height: 400px;">
                                        <RadzenDonutSeries Data="@_timeDistributionData"
                                                         CategoryProperty="Category"
                                                         ValueProperty="Value"
                                                         Title="Hours">
                                            <TitleTemplate>
                                                <div style="text-align: center;">
                                                    <div style="font-size: 2rem; font-weight: 800;">@_analytics.TimeUsage.TotalScheduledHours</div>
                                                    <div style="font-size: 0.9rem; opacity: 0.7;">Total Hours</div>
                                                </div>
                                            </TitleTemplate>
                                        </RadzenDonutSeries>
                                    </RadzenChart>
                                </RadzenStack>
                            </RadzenCard>
                        }
                    </RadzenStack>
                </RadzenTabsItem>

                <!-- Benchmarks Tab -->
                <RadzenTabsItem Text="Benchmarks" Icon="show_chart">
                    <RadzenStack Gap="1.5rem" Style="padding-top: 1.5rem;">
                        <!-- Controls -->
                        <RadzenCard>
                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem">
                                <RadzenButton Icon="refresh" Text="Refresh" Click="@LoadBenchmarkData" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Small" />
                                <RadzenDropDown TValue="int" @bind-Value="@_selectedBenchmarkPeriod" Data="@_periodOptions" TextProperty="Text" ValueProperty="Value"
                                              Change="@OnBenchmarkPeriodChanged" Style="width: 120px;" />
                            </RadzenStack>
                        </RadzenCard>

                        @if (_loadingBenchmarks)
                        {
                            <RadzenCard Style="padding: 3rem; text-align: center;">
                                <RadzenStack Gap="1rem" AlignItems="AlignItems.Center">
                                    <RadzenProgressBarCircular ShowValue="false" Mode="ProgressBarMode.Indeterminate" Size="ProgressBarCircularSize.Large" />
                                    <RadzenText Style="opacity: 0.7;">Loading benchmarks...</RadzenText>
                                </RadzenStack>
                            </RadzenCard>
                        }
                        else if (_benchmarkReport != null)
                        {
                            <!-- Overall Score -->
                            <RadzenCard>
                                <RadzenStack Gap="1.5rem">
                                    <RadzenText TextStyle="TextStyle.H5" Style="font-weight: 700;">Industry Comparison</RadzenText>

                                    <RadzenRow>
                                        <RadzenColumn Size="12" SizeMD="4">
                                            <div style="text-align: center;">
                                                <RadzenArcGauge Style="width: 200px; height: 200px; margin: 0 auto;">
                                                    <RadzenArcGaugeScale Min="0" Max="100" Y="0.8">
                                                        <RadzenArcGaugeScaleValue Value="@_benchmarkReport.OverallScore" Fill="@GetScoreColor(_benchmarkReport.OverallScore)" />
                                                    </RadzenArcGaugeScale>
                                                </RadzenArcGauge>
                                                <RadzenText TextStyle="TextStyle.H4" Style="margin-top: 1rem;">@_benchmarkReport.OverallScore.ToString("F0") / 100</RadzenText>
                                                <RadzenText TextStyle="TextStyle.Body1" Style="color: #666;">@GetScoreLabel(_benchmarkReport.OverallScore)</RadzenText>
                                            </div>
                                        </RadzenColumn>

                                        <RadzenColumn Size="12" SizeMD="8">
                                            <RadzenStack Gap="1rem">
                                                <RadzenRow>
                                                    <RadzenColumn Size="4">
                                                        <div style="text-align: center; padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                                                            <RadzenText TextStyle="TextStyle.H4" Style="color: #4CAF50; margin: 0;">@_benchmarkReport.MetricsAboveStandard</RadzenText>
                                                            <RadzenText TextStyle="TextStyle.Body2" Style="color: #666; margin: 0;">Excellent</RadzenText>
                                                        </div>
                                                    </RadzenColumn>
                                                    <RadzenColumn Size="4">
                                                        <div style="text-align: center; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 8px;">
                                                            <RadzenText TextStyle="TextStyle.H4" Style="color: #2196F3; margin: 0;">@_benchmarkReport.MetricsAtStandard</RadzenText>
                                                            <RadzenText TextStyle="TextStyle.Body2" Style="color: #666; margin: 0;">At Standard</RadzenText>
                                                        </div>
                                                    </RadzenColumn>
                                                    <RadzenColumn Size="4">
                                                        <div style="text-align: center; padding: 1rem; background: rgba(244, 67, 54, 0.1); border-radius: 8px;">
                                                            <RadzenText TextStyle="TextStyle.H4" Style="color: #F44336; margin: 0;">@_benchmarkReport.MetricsBelowStandard</RadzenText>
                                                            <RadzenText TextStyle="TextStyle.Body2" Style="color: #666; margin: 0;">Needs Attention</RadzenText>
                                                        </div>
                                                    </RadzenColumn>
                                                </RadzenRow>

                                                @if (_benchmarkReport.TopRecommendations.Any())
                                                {
                                                    <div class="recommendation-box">
                                                        <RadzenStack Gap="0.5rem">
                                                            <RadzenText TextStyle="TextStyle.Subtitle2" Style="font-weight: 700; margin: 0;">ðŸ’¡ Recommendations</RadzenText>
                                                            @foreach (var recommendation in _benchmarkReport.TopRecommendations)
                                                            {
                                                                <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0;">â€¢ @recommendation</RadzenText>
                                                            }
                                                        </RadzenStack>
                                                    </div>
                                                }
                                            </RadzenStack>
                                        </RadzenColumn>
                                    </RadzenRow>
                                </RadzenStack>
                            </RadzenCard>
                        }
                    </RadzenStack>
                </RadzenTabsItem>
            </Tabs>
        </RadzenTabs>
    </RadzenStack>
</div>

@code {
    // Analytics
    private CalendarAnalytics? _analytics;
    private List<ChartDataItem> _timeDistributionData = new();
    private int _selectedDays = 30;
    private bool _loadingAnalytics = false;
    private bool _downloadingPdf = false;
    private bool _downloadingCsv = false;
    private bool _downloadingExcel = false;

    // Benchmarks
    private BenchmarkReport? _benchmarkReport;
    private int _selectedBenchmarkPeriod = 30;
    private bool _loadingBenchmarks = false;
    private List<PeriodOption> _periodOptions = new()
    {
        new PeriodOption { Text = "7 Days", Value = 7 },
        new PeriodOption { Text = "30 Days", Value = 30 },
        new PeriodOption { Text = "90 Days", Value = 90 }
    };

    // Overview
    private bool _loadingOverview = false;
    private double _healthScore = 75;

    protected override async Task OnInitializedAsync()
    {
        await LoadOverview();
    }

    private async void OnTabChange(int index)
    {
        switch (index)
        {
            case 0: // Overview
                if (_analytics == null)
                {
                    await LoadOverview();
                }
                break;
            case 1: // Time Analysis
                if (_analytics == null)
                {
                    await LoadAnalytics(_selectedDays);
                }
                break;
            case 2: // Benchmarks
                if (_benchmarkReport == null)
                {
                    await LoadBenchmarkData();
                }
                break;
        }
    }

    private async Task LoadOverview()
    {
        _loadingOverview = true;
        StateHasChanged();

        try
        {
            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var userId = authState.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value ?? string.Empty;

            if (string.IsNullOrEmpty(userId))
            {
                Logger.LogWarning("Unable to determine current user");
                return;
            }

            // Load basic analytics
            _analytics = await AnalyticsService.GenerateAnalyticsAsync(userId, DateTime.Now.AddDays(-30), DateTime.Now);

            // Load benchmarks
            _benchmarkReport = await BenchmarkService.GenerateBenchmarkReportAsync(userId, 30);

            // Calculate health score
            _healthScore = _benchmarkReport?.OverallScore ?? 75;

            // Load time distribution data
            if (_analytics != null && _analytics.TimeUsage.EventTypeHours.Any())
            {
                _timeDistributionData = _analytics.TimeUsage.EventTypeHours
                    .Select(kvp => new ChartDataItem { Category = kvp.Key.ToString(), Value = kvp.Value })
                    .ToList();
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error loading overview");
        }
        finally
        {
            _loadingOverview = false;
            StateHasChanged();
        }
    }

    #region Analytics Methods

    private async Task LoadAnalytics(int days)
    {
        _selectedDays = days;
        _loadingAnalytics = true;
        StateHasChanged();

        try
        {
            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var userId = authState.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value ?? string.Empty;

            if (string.IsNullOrEmpty(userId))
            {
                Logger.LogWarning("Unable to determine current user");
                return;
            }

            var endDate = DateTime.Now;
            var startDate = endDate.AddDays(-days);

            _analytics = await AnalyticsService.GenerateAnalyticsAsync(userId, startDate, endDate);

            // Prepare chart data
            if (_analytics.TimeUsage.EventTypeHours.Any())
            {
                _timeDistributionData = _analytics.TimeUsage.EventTypeHours
                    .Select(kvp => new ChartDataItem { Category = kvp.Key.ToString(), Value = kvp.Value })
                    .ToList();
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error loading analytics");
        }
        finally
        {
            _loadingAnalytics = false;
            StateHasChanged();
        }
    }

    private string GetPeriodText()
    {
        return _selectedDays switch
        {
            7 => "Last 7 Days",
            30 => "Last 30 Days",
            90 => "Last 90 Days",
            365 => "Last Year",
            _ => $"Last {_selectedDays} Days"
        };
    }

    private async Task DownloadPdfReport()
    {
        _downloadingPdf = true;
        try
        {
            if (_analytics == null) return;

            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var userName = authState.User.Identity?.Name ?? "User";
            var pdfBytes = await ReportService.GeneratePdfReportAsync(_analytics, userName, null);
            await JSRuntime.InvokeVoidAsync("downloadFile", "analytics-report.pdf", "application/pdf", Convert.ToBase64String(pdfBytes));
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error generating PDF report");
        }
        finally
        {
            _downloadingPdf = false;
        }
    }

    private async Task DownloadCsvReport()
    {
        _downloadingCsv = true;
        try
        {
            if (_analytics == null) return;

            var csvBytes = await ReportService.GenerateCsvReportAsync(_analytics, null);
            await JSRuntime.InvokeVoidAsync("downloadFile", "analytics-data.csv", "text/csv", Convert.ToBase64String(csvBytes));
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error generating CSV report");
        }
        finally
        {
            _downloadingCsv = false;
        }
    }

    private async Task DownloadExcelReport()
    {
        _downloadingExcel = true;
        try
        {
            if (_analytics == null) return;

            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var userName = authState.User.Identity?.Name ?? "User";
            var excelBytes = await ReportService.GenerateExcelReportAsync(_analytics, userName, null);
            await JSRuntime.InvokeVoidAsync("downloadFile", "analytics-report.xlsx", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", Convert.ToBase64String(excelBytes));
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error generating Excel report");
        }
        finally
        {
            _downloadingExcel = false;
        }
    }

    #endregion

    #region Benchmark Methods

    private async Task LoadBenchmarkData()
    {
        _loadingBenchmarks = true;
        StateHasChanged();

        try
        {
            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var userId = authState.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value ?? string.Empty;

            if (string.IsNullOrEmpty(userId))
            {
                Logger.LogWarning("Unable to determine current user");
                return;
            }

            _benchmarkReport = await BenchmarkService.GenerateBenchmarkReportAsync(userId, _selectedBenchmarkPeriod);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error loading benchmark data");
        }
        finally
        {
            _loadingBenchmarks = false;
            StateHasChanged();
        }
    }

    private async Task OnBenchmarkPeriodChanged()
    {
        await LoadBenchmarkData();
    }

    #endregion

    #region Helper Methods

    private string GetScoreColor(double score)
    {
        return score switch
        {
            >= 80 => "#4CAF50",
            >= 60 => "#2196F3",
            >= 40 => "#FF9800",
            _ => "#F44336"
        };
    }

    private string GetScoreLabel(double score)
    {
        return score switch
        {
            >= 80 => "Excellent",
            >= 60 => "Good",
            >= 40 => "Fair",
            _ => "Needs Improvement"
        };
    }

    #endregion

    // Helper classes
    public class ChartDataItem
    {
        public string Category { get; set; } = string.Empty;
        public double Value { get; set; }
    }

    public class PeriodOption
    {
        public string Text { get; set; } = string.Empty;
        public int Value { get; set; }
    }
}
