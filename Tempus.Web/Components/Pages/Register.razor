@page "/Account/Register"
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Identity
@using Tempus.Core.Models

@inject NavigationManager NavigationManager

<PageTitle>Register - Tempus</PageTitle>

<div class="hero-section" style="min-height: 100vh; padding: 2rem 0;">
    <div class="hero-bg-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
    </div>

    <div class="hero-content" style="max-width: 600px;">
        <div class="dashboard-card" style="padding: 3rem;">
            <RadzenStack Gap="2rem">
                <div style="text-align: center;">
                    <div style="width: 60px; height: 60px; background: var(--primary-gradient); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                        <RadzenIcon Icon="person_add" Style="color: white; font-size: 2rem;" />
                    </div>
                    <RadzenText TextStyle="TextStyle.H4" Style="font-weight: 700; margin-bottom: 0.5rem;">Create Account</RadzenText>
                    <RadzenText Style="color: #718096;">Join Tempus and start managing your time</RadzenText>
                </div>

                @if (!string.IsNullOrEmpty(errorMessage))
                {
                    <RadzenAlert AlertStyle="AlertStyle.Danger" Variant="Variant.Flat" Shade="Shade.Lighter">
                        @errorMessage
                    </RadzenAlert>
                }

                <form method="post" action="/Account/PerformRegister">
                    <AntiforgeryToken />
                    <RadzenStack Gap="1.5rem">
                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenStack Gap="0.5rem">
                                    <RadzenLabel Text="First Name" />
                                    <input type="text" name="firstName" required placeholder="John" maxlength="50"
                                           style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;" />
                                </RadzenStack>
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenStack Gap="0.5rem">
                                    <RadzenLabel Text="Last Name" />
                                    <input type="text" name="lastName" required placeholder="Doe" maxlength="50"
                                           style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;" />
                                </RadzenStack>
                            </RadzenColumn>
                        </RadzenRow>

                        <RadzenStack Gap="0.5rem">
                            <RadzenLabel Text="Email" />
                            <input type="email" name="email" required placeholder="your@email.com"
                                   style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;" />
                        </RadzenStack>

                        <RadzenStack Gap="0.5rem">
                            <RadzenLabel Text="Password" />
                            <input type="password" name="password" required placeholder="Enter password" minlength="6"
                                   style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;" />
                            <RadzenText Style="font-size: 0.85rem; color: #718096;">
                                Must be at least 6 characters with uppercase, lowercase, and digit
                            </RadzenText>
                        </RadzenStack>

                        <RadzenStack Gap="0.5rem">
                            <RadzenLabel Text="Confirm Password" />
                            <input type="password" name="confirmPassword" required placeholder="Confirm password" minlength="6"
                                   style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;" />
                        </RadzenStack>

                        <button type="submit" style="width: 100%; height: 50px; font-size: 1.1rem; font-weight: 600; border-radius: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; cursor: pointer;">
                            Create Account
                        </button>

                        <div style="text-align: center;">
                            <RadzenText Style="color: #718096;">
                                Already have an account?
                                <RadzenLink Path="/Account/Login" Style="color: #667eea; font-weight: 600;">Sign in</RadzenLink>
                            </RadzenText>
                        </div>
                    </RadzenStack>
                </form>
            </RadzenStack>
        </div>
    </div>
</div>

@code {
    private string? errorMessage;

    [SupplyParameterFromQuery(Name = "error")]
    private string? Error { get; set; }

    protected override void OnInitialized()
    {
        if (!string.IsNullOrEmpty(Error))
        {
            // Error codes are comma-separated from Identity errors
            var errors = Error.Split(',');
            errorMessage = "Registration failed. Please check your input and try again.";

            if (errors.Contains("DuplicateUserName") || errors.Contains("DuplicateEmail"))
            {
                errorMessage = "An account with this email already exists.";
            }
            else if (errors.Contains("PasswordTooShort") || errors.Contains("PasswordRequiresNonAlphanumeric")
                || errors.Contains("PasswordRequiresDigit") || errors.Contains("PasswordRequiresLower")
                || errors.Contains("PasswordRequiresUpper"))
            {
                errorMessage = "Password must be at least 6 characters with uppercase, lowercase, and a digit.";
            }
        }
    }
}
