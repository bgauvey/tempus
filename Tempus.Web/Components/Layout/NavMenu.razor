@using Tempus.Web.Components.Shared
@inject DialogService DialogService
@inject ContextMenuService ContextMenuService

<RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
    <RadzenButton Icon="notifications" ButtonStyle="ButtonStyle.Light"
                  Style="border-radius: 50%; width: 40px; height: 40px; padding: 0;" />

    <!-- Help Button -->
    <RadzenButton Icon="help_outline" ButtonStyle="ButtonStyle.Light"
                  Click="@ShowHelpMenu"
                  Style="border-radius: 50%; width: 40px; height: 40px; padding: 0;" />

    <UserAvatar />
</RadzenStack>

@code {
    [CascadingParameter]
    public HelpPopover? HelpPopover { get; set; }

    private void ShowHelpMenu(MouseEventArgs args)
    {
        ContextMenuService.Open(args,
            new List<ContextMenuItem>
            {
                new ContextMenuItem
                {
                    Text = "Help Center",
                    Icon = "help",
                    Value = "help"
                },
                new ContextMenuItem
                {
                    Text = "Contact Support",
                    Icon = "support_agent",
                    Value = "support"
                }
            },
            OnMenuItemClick
        );
    }

    private void OnMenuItemClick(MenuItemEventArgs args)
    {
        ContextMenuService.Close();

        if (args.Value?.ToString() == "help")
        {
            if (HelpPopover != null)
            {
                _ = HelpPopover.Show();
            }
        }
        else if (args.Value?.ToString() == "support")
        {
            _ = ShowContactSupport();
        }
    }

    private async Task ShowContactSupport()
    {
        await DialogService.Alert(
            @"<p>Need help? We're here to support you!</p>
              <p><strong>Email:</strong> support@tempus-app.com</p>
              <p><strong>Hours:</strong> Monday-Friday, 9 AM - 5 PM EST</p>
              <p>For urgent issues, please email us with ""URGENT"" in the subject line.</p>
              <p>We typically respond within 24 hours during business days.</p>",
            "Contact Support",
            new AlertOptions { OkButtonText = "Close" }
        );
    }
}
