@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Web
@using Tempus.Core.Models
@using Microsoft.AspNetCore.Identity
@using Tempus.Web.Components.Shared
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager
@inject UserManager<ApplicationUser> UserManager
@inject ThemeService ThemeService

<RadzenComponents @rendermode="InteractiveServer" />
<ScrollToTopHandler />

<RadzenLayout>
    <!-- Public Header for Unauthenticated Users -->
    <AuthorizeView>
        <NotAuthorized>
            <RadzenHeader>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="1rem" JustifyContent="JustifyContent.SpaceBetween">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        <RadzenIcon Icon="access_time" />
                        <RadzenText TextStyle="TextStyle.H5">
                            Tempus
                        </RadzenText>
                    </RadzenStack>

                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="2rem">
                        <RadzenLink Path="/">Home</RadzenLink>
                        <RadzenLink Path="/features">Features</RadzenLink>
                        <RadzenLink Path="/about">About</RadzenLink>
                        <RadzenDropDown Name="ThemeDropDown" 
                                        TValue="string" 
                                        Value="@ThemeService.Theme" 
                                        ValueChanged="@OnThemeChanged" 
                                        Data="@Themes.Free" 
                                        TextProperty=@nameof(Theme.Text) 
                                        ValueProperty=@nameof(Theme.Value)
                                        Width="150px" Style="width: 150px;">
                        </RadzenDropDown>
                        <RadzenLink Path="/Account/Login">Login</RadzenLink>
                    </RadzenStack>
                </RadzenStack>
            </RadzenHeader>
        </NotAuthorized>
        <Authorized>
            <RadzenHeader>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="1rem" JustifyContent="JustifyContent.SpaceBetween">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="1rem">
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                            <RadzenIcon Icon="access_time" />
                            <RadzenText TextStyle="TextStyle.H5">
                                Tempus
                            </RadzenText>
                        </RadzenStack>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="1rem">
                        <RadzenDropDown Name="ThemeDropDown" 
                                        TValue="string" 
                                        Value="@ThemeService.Theme" 
                                        ValueChanged="@OnThemeChanged" 
                                        Data="@Themes.Free" 
                                        TextProperty=@nameof(Theme.Text) 
                                        ValueProperty=@nameof(Theme.Value)
                                        Width="150px" Style="width: 150px;">
                        </RadzenDropDown>
                        <NavMenu />
                    </RadzenStack>
                </RadzenStack>
            </RadzenHeader>
        </Authorized>
    </AuthorizeView>

    <!-- Sidebar only for Authenticated Users -->
    <AuthorizeView>
        <Authorized>
            <RadzenSidebar FullHeight="true"  @bind-Expanded="_drawerOpen">
                <RadzenPanelMenu>
                    <RadzenPanelMenuItem Text="Dashboard" Path="/dashboard" Icon="dashboard" />
                    <RadzenPanelMenuItem Text="Calendar" Path="/calendar" Icon="calendar_month" />
                    <RadzenPanelMenuItem Text="Import ICS" Path="/import" Icon="upload" />
                    <RadzenPanelMenuItem Text="Integrations" Path="/integrations" Icon="link" />
                    <RadzenPanelMenuItem Text="Address Book" Path="/addresses" Icon="contacts" />
                </RadzenPanelMenu>
            </RadzenSidebar>
        </Authorized>
    </AuthorizeView>
    <RadzenBody>
        <main id="main-content" tabindex="-1">
            @Body
        </main>

        <AuthorizeView>
            <NotAuthorized>
                <footer>
                    <div class="container-max">
                        <RadzenRow Gap="2rem">
                            <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                                <RadzenStack Gap="1rem">
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                        <RadzenIcon Icon="access_time" />
                                        <RadzenText TextStyle="TextStyle.H5">Tempus</RadzenText>
                                    </RadzenStack>
                                    <RadzenText>Master your time, transform your business. The ultimate time management platform.</RadzenText>
                                </RadzenStack>
                            </RadzenColumn>

                            <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                                <RadzenStack Gap="0.75rem">
                                    <RadzenText TextStyle="TextStyle.H6">Company</RadzenText>
                                    <RadzenLink Path="/about">About Us</RadzenLink>
                                    <RadzenLink Path="#">Blog</RadzenLink>
                                    <RadzenLink Path="#">Careers</RadzenLink>
                                    <RadzenLink Path="/contact">Contact</RadzenLink>
                                </RadzenStack>
                            </RadzenColumn>

                            <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                                <RadzenStack Gap="0.75rem">
                                    <RadzenText TextStyle="TextStyle.H6">Legal</RadzenText>
                                    <RadzenLink Path="/privacy">Privacy Policy</RadzenLink>
                                    <RadzenLink Path="/terms">Terms of Service</RadzenLink>
                                    <RadzenLink Path="/security">Security</RadzenLink>
                                    <RadzenLink Path="/gdpr">GDPR</RadzenLink>
                                </RadzenStack>
                            </RadzenColumn>
                        </RadzenRow>

                        <RadzenRow JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenText>Â© @DateTime.Now.Year Tempus. All rights reserved.</RadzenText>
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" JustifyContent="JustifyContent.End">
                                    <RadzenButton Icon="share" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Small" />
                                    <RadzenButton Icon="link" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Small" />
                                    <RadzenButton Icon="email" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Small" />
                                </RadzenStack>
                            </RadzenColumn>
                        </RadzenRow>
                    </div>
                </footer>
            </NotAuthorized>
        </AuthorizeView>
    </RadzenBody>
</RadzenLayout>

@code {
    private bool _drawerOpen = true;
    private string _currentTheme = "material";

    private class ThemeOption
    {
        public string Value { get; set; } = string.Empty;
        public string Label { get; set; } = string.Empty;
    }

    private List<ThemeOption> _themeOptions = new List<ThemeOption>
    {
        new ThemeOption { Value = "default", Label = "Default" },
        new ThemeOption { Value = "dark", Label = "Dark" },
        new ThemeOption { Value = "humanistic", Label = "Humanistic" },
        new ThemeOption { Value = "humanistic-dark", Label = "Humanistic Dark" },
        new ThemeOption { Value = "material", Label = "Material" },
        new ThemeOption { Value = "material-dark", Label = "Material Dark" },
        new ThemeOption { Value = "software", Label = "Software" },
        new ThemeOption { Value = "software-dark", Label = "Software Dark" },
        new ThemeOption { Value = "standard", Label = "Standard" },
        new ThemeOption { Value = "standard-dark", Label = "Standard Dark" }
    };

    private void ToggleDrawer()
    {
        _drawerOpen = !_drawerOpen;
    }

    private void OnThemeChanged(string value)
    {
        ThemeService.SetTheme(value);
    }
}
